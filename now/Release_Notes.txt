2016-11-09:

Устройство, которое недоступно более 5 минут опрашивается 1 раз в минуту.

С базовой станции собираются следующие параметры в отдельную таблицу statss_base:
.1.3.6.1.4.1.10002.1.1.1.4.2.1.3.1 load average 1 minute
.1.3.6.1.2.1.2.2.1.10.2   eth0: The total number of octets received on the interface, including framing characters.
.1.3.6.1.2.1.2.2.1.16.2   eth0: The total number of octets transmitted out of the interface, including framing characters.
.1.3.6.1.4.1.10002.1.1.1.1.2.0 Mem free

2016-11-10:
При неответе по snmp пишу -1 в loadavg;
вместо total number of octets пишу в базу значения скоростей, рассчитанных как:

nowtickcount:=gettickcount;
if lasttickcount>0 then begin
  tx_per_sec:=(tx_octets_eth0-last_tx_octets)*8/(nowtickcount-lasttickcount);
  lasttickcount := gettickcount;
end else
if (tx_octets_eth0-last_tx_octets)>0 then lasttickcount := gettickcount;
(байт/сек)

2016-11-15:
Вынес 4 настройки потоков опроса на главную форму: PredvPing, PeriodOprosa, PeriodOprosaUnreachble, SnmpTimeout
Исправил ошибку - поток зависал при попытке записи отрицательного значения в stats_ap
Изменил тип полей 'x' и 'y' в statss_local с TSmallintField[-32768 to 32767] На TIntegerField[-2147483648 to 2147483647] - из-за этого могла 
возникать ошибка записи в локальную таблицу.
Расширил запись в лог при возникновении ошибки при выполнении SaveToLocalDB в потоке синхронизации.

2016-11-16:
При остановке и запуске сбора новые переменные не применялись. Переделал процедуры останова и запуска в которых убиваю потоки сбора (стоп сбор)
 и создаю занова (старт сбор).

2017-02-23
Добавил таймер на перезапуск сбора каждые 5 часов. Убрал вывод в лог ответа от ssh при мониторинге точки доступа 10.70.120.22

2017-02-24
Добавил задержку в 8+rаndom(80) милисекунды после создания каждого потока сбора статистики (для рассинхронизации сбора и разгрузки сети)

2017-02-25
Добавил массив ArrayIdModems5MinNoPing. Этот массив инициируется при запуске приложения и убивается при его закрытии. Это массив флагов: 
1 - устройство не пингуется 5 минут. Сделано для того, чтобы при перезапуске сбора статистики по таймеру или по кнопкам отключенные устройства не
начали опрашиваться с минимально установленным периодом.

2017-11-21
Отключил таймер на перезапуск сбора каждые 5 часов. Зависает на перезапуске.

2018-08-13
change snmp.community for AP as on Clients - ubnt_mlink54.
изменил сбор статистики для ар-репитера (мак пира берет из mac_wds_peer таблицы modems и пишет одновременно в таблицу statss и в таблицу statss_ap)

2018-10-21
Добавил проверку в потоке синхронизации при получении данных из LocalDB:
if loadavg='' then loadavg:='0';
if memfree ='' then memfree :='0';
if rx_octets_eth0='' then rx_octets_eth0:='0';
if tx_octets_eth0='' then tx_octets_eth0 :='0';
Это сделано для того, чтобы не возникало ошибки при смене режима работы клиенского булита с AP-Repeater на Station

2019-12-12
Изменил условие equipment_type <= 5 т.к. добавились бурстанки. И default_status для бурстанков = 2 как для БС.

2020-01-21
Добавил проверку версии прошивки булета раз в 5 минут и обновление её при необходимости в MySQL

2020-01-25
Исправил проверку SMOTR2(сломалось после обновления версии), вынес настройки сбора на форму (пару галочек), сделал чтобы с булитов как и с баз собирать 
статистику

2020-02-01
Добавлено: 1 раз в 5 минут считываем из базы параметр is_ap_repeater. 
Исправил ошибку, возникающую при закрытии сбора статистики (оказалось, что ошибка возникала при совместном использовании файла cl32.dll двумя приложениями. Вынес sbor_stats.exe в отдельную папку.).
Ошибка эта всё равно периодически появляется.

2020-02-19
Не считывался параметр is_ap_repeater из базы (не работало через synhronize - сделал динамически создаваемый ADOQuery в потоках).

2020-02-20
Исправил ошибку, возникающую при сохранении параметров репитера: добавил 
         if f_loadavg='' then f_loadavg:='0';
         if f_rx_octets_eth0='' then f_rx_octets_eth0:='0';
         if f_tx_octets_eth0='' then f_tx_octets_eth0:='0';
         if f_memfree='' then f_memfree:='0';

2020-03-02
Перенес ini файл в тпапку с приложением. Убрал synhronize, добавил глобальную критическую секцию.

2020-03-02
- Изменил условие equipment_type <= 6 т.к. у СЗМ поменяли тип оборудования. 
- default_status для бурстанков и СЗМ изменил на 0, т.к. сделали реализацию подгрузки статусов.

2020-04-04
Отключил поток для проверки и отключения Smotr2. Переделал поток удаления старых записей - в sql-запрос удаления добавил limit 50000 для statss и 15000 для statss_ap.
Сделал динамическое создание ADOQuery и ADOConnection в потоках, где есть обращения к MySQL. Переделал логирование - теперь пишется сразу в файл, а при запуске - подгружается лог.

2020-04-05
- Убрал критическую секцию из PutToMySQL в потоке синхронизации, т.к. слишком медленно записывает в MySQL, и она не нужна - у каждого потока свой Query и Connection.
- Убрал из других потоков критические секции при работе с MySQL.
- Заменил Free на FreeAndNil
- Не удаляю созданный в потоке динамический Query. Удаляю при завершении потока. Тоже самое с объектом snmp. Иначе - утечка памяти :-(

2020-04-06
Приложение вылетело по ошибке в функции проверки IsAP_Reapiter. Возможно, из-за того, что я не закрывал AQuery b AConn (ошибка). Исправил.
Убрал динамический массив для проверки того что  устройство не доступно более 5 минут.


2020-04-07
Вынес проверку firmware и is_ap_repeater в отдельный поток, который в цикле по всем потокам проверяет раз в 5 минут.
Убрал галочку с основной формы 'Проверять firmware ver' - проверяется всегда.
Переделал завершение потоков при закрытии формы.

2020-04-15
Исправил ошибку в потоке проверки firmware, при которой мог записаться пустой firmware и сбор по единице прекращался.

2020-07-21
Исправил ошибку возникающую при попытке записи пустого сигнала (это происходит, когда экскаватор включаем репитером)

2020-12-04
Добавил опрос булетов СЗМ в гараже (взрывцехе)

2021-08-04
Добавил опрос lte-модемов

2021-08-10
Столкнулся с тем, что у mikrotik-ов индекс LTE-интерфейса может различаться у разных модемов. А mib для запроса уровней сигналов содержит индекс интерфейса в конце. 
Сделал поиск индекса интерфейса при инициализации потока (запрашиваю все 5 интерфейсов MIBами interfaces.ifTable.ifEntry.ifDescr.1 .. 5)

2021-08-16
Добавил сбор пингов со всех PTX и КОБУС в таблицу stats_ping.
Добавил столбец id_equipment в таблицы statss и stats_ap и сбор значений в них.
Добавил обновление поля online в таблице modems при сборе пинга.

2021-08-20
Переделал сбор статистики модемов LTE с ip_vpn на ip_lte

2021-08-24
Добавил задержки в потоке синхронизации между последовательными задачами, между insert и update в задаче dowork_ping, между insert и delete и пр. - иногда ошибки типа Deadlock found when trying to get lock; try restarting transaction

2021-08-24
Убрал задержки - с ними торррмозит синхронизация

2021-08-25
Добавил обновление поля online в таблице modems для базовых станций

2021-09-14
Не собирались данные по Bullet-ам в режиме AP-Repeater с новой прошивкой. Использовались старые mib.

2021-09-15
Оказывается, не собирались данные в столбец id_equipment таблиц statss и stats_ap - недоделал. Теперь доделал.

2021-09-16
Добавил поля datetime в таблицы для сбора статистики и переделал сбор данных в них (пока в date и time тоже пишется)

2021-09-17
Обнаружил, что старые записи (старше 70 дней) давно не удалялись (в БД записи с 29.01.21). Переделал поток удаления - сделал хранимую процедуру, которую вызываю в потоке.
Сделал визуализацию количества потоков.